<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venda de RemÃ©dios</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        #form-container {
            max-width: 500px;
            width: 100%;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            color: #333;
        }
        .form-title {
            font-size: 24px;
            color: #d9534f;
            margin-bottom: 10px;
            font-weight: bold;
            text-align: center;
        }
        .form-field {
            margin-bottom: 15px;
        }
        .form-label {
            font-weight: bold;
            color: #555;
            display: block;
            margin-bottom: 5px;
        }
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background-color: #007BFF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: block;
            margin: 20px auto 0;
            font-weight: bold;
        }
        button:hover {
            background-color: #0056b3;
        }
        .embed-output {
            margin-top: 20px;
            padding: 10px;
            background-color: #e7f3fe;
            border: 1px solid #b3d4fc;
            border-radius: 5px;
            max-height: 300px; /* Limita a altura mÃ¡xima do output */
            overflow: auto; /* Adiciona rolagem se necessÃ¡rio */
        }
    </style>
</head>
<body>

    <div id="form-container">
        <div class="form-title">ðŸ’Š FormulÃ¡rio de Venda</div>
        
        <div class="form-field">
            <label class="form-label">ðŸ‘¤ Nome do Cliente:</label>
            <input type="text" id="clientName" class="form-input" required>
        </div>
        <div class="form-field">
            <label class="form-label">ðŸ†” NÃºmero do Passaporte:</label>
            <input type="text" id="passportNumber" class="form-input" required>
        </div>
        <div class="form-field">
            <label class="form-label">ðŸ“¦ Quantidade Vendida:</label>
            <input type="number" id="soldQuantity" class="form-input" required>
        </div>
        <div class="form-field">
            <label class="form-label">ðŸ’µ Valor por RemÃ©dio:</label>
            <input type="number" id="RemÃ©dioValue" class="form-input" required>
        </div>
        <div class="form-field">
            <label class="form-label">ðŸ©º Nome do MÃ©dico:</label>
            <input type="text" id="doctorName" class="form-input" required>
        </div>
        <div class="form-field">
            <label class="form-label">ðŸ†” ID do MÃ©dico:</label>
            <input type="number" id="doctorId" class="form-input" required>
        </div>
        
        <button id="generateEmbed">Gerar Embed</button>

        <div class="embed-output" id="embedOutput" style="display:none;">
            <!-- Aqui podemos deixar vazio para enviar o embed -->
        </div>
        
        <button id="sendWebhook" style="margin-top: 10px;">Enviar Dados</button>
    </div>

    <script>
        // FunÃ§Ã£o para carregar os dados do localStorage
        function loadSalesData() {
            const storedData = localStorage.getItem('salesData');
            return storedData ? JSON.parse(storedData) : {};
        }
    
        // FunÃ§Ã£o para salvar os dados no localStorage
        function saveSalesData(data) {
            localStorage.setItem('salesData', JSON.stringify(data));
        }
    
        let salesData = loadSalesData(); // Carrega dados do localStorage
    
        document.getElementById("generateEmbed").addEventListener("click", function() {
            const clientName = document.getElementById("clientName").value;
            const passportNumber = document.getElementById("passportNumber").value;
            const soldQuantity = parseFloat(document.getElementById("soldQuantity").value);
            const RemÃ©dioValue = parseFloat(document.getElementById("RemÃ©dioValue").value);
            const doctorName = document.getElementById("doctorName").value;
            const doctorId = document.getElementById("doctorId").value;
    
            const totalAmount = soldQuantity * RemÃ©dioValue; // CÃ¡lculo do total da venda
            const taxAmount = totalAmount * 0.40; // CÃ¡lculo do imposto
    
            // Atualiza os dados de vendas para o ID do mÃ©dico
            if (!salesData[doctorId]) {
                salesData[doctorId] = {
                    totalSales: 0,
                    totalTaxes: 0
                };
            }
    
            // Atualiza os totais
            salesData[doctorId].totalSales += totalAmount; // Soma o total da venda
            salesData[doctorId].totalTaxes += taxAmount; // Soma o imposto
    
            // Salva os dados atualizados no localStorage
            saveSalesData(salesData);
        });
    
        document.getElementById("sendWebhook").addEventListener("click", function() {
            const clientName = document.getElementById("clientName").value;
            const passportNumber = document.getElementById("passportNumber").value;
            const soldQuantity = document.getElementById("soldQuantity").value;
            const RemÃ©dioValue = document.getElementById("RemÃ©dioValue").value;
            const totalAmount = soldQuantity * RemÃ©dioValue; // Recalcula o total
            const taxAmount = totalAmount * 0.40; // Recalcula o imposto
            const doctorName = document.getElementById("doctorName").value;
            const doctorId = document.getElementById("doctorId").value;
            const taxId = 7; // ID do imposto, conforme fornecido
            const accumulatedSales = salesData[doctorId].totalSales || 0; // Total acumulado de vendas
            const accumulatedTaxes = salesData[doctorId].totalTaxes || 0; // Total acumulado de impostos
    
            const webhookUrl = 'https://discord.com/api/webhooks/1302297331449725050/-79XhjOQYiiSNBaOq0A9WQezJ5lD-rywn3I5jgrDdRl2wJ_-iZOvpyVosShzJO2kq-OG'; // Sua URL de webhook
            const payload = {
                embeds: [{
                    color: 3447003, // Cor verde
                    author: {
                        name: "ðŸ’Š Venda Registrada",
                        icon_url: "https://cdn-icons-png.flaticon.com/128/17705/17705887.png" // Ãcone
                    },
                    description: "Os detalhes da venda sÃ£o os seguintes:",
                    fields: [
                        {
                            name: "ðŸ‘¤ Nome do Cliente",
                            value: clientName,
                            inline: true
                        },
                        {
                            name: "ðŸ†” NÃºmero do Passaporte",
                            value: passportNumber,
                            inline: true
                        },
                        {
                            name: "ðŸ“¦ Quantidade Vendida",
                            value: soldQuantity,
                            inline: true
                        },
                        {
                            name: "ðŸ’µ Valor por RemÃ©dio",
                            value: `R$ ${parseFloat(RemÃ©dioValue).toFixed(2)}`,
                            inline: true
                        },
                        {
                            name: "ðŸ’° Total a Pagar",
                            value: `R$ ${parseFloat(totalAmount).toFixed(2)}`,
                            inline: true
                        },
                        {
                            name: "âš ï¸ Imposto Calculado (40%)",
                            value: `R$ ${parseFloat(taxAmount).toFixed(2)}`,
                            inline: true
                        },
                        {
                            name: "ðŸ©º Nome do MÃ©dico",
                            value: doctorName,
                            inline: true
                        },
                        {
                            name: "ðŸ†” ID do MÃ©dico",
                            value: doctorId,
                            inline: true
                        },
                        {
                            name: "ðŸ“‘ ID do Imposto",
                            value: taxId,
                            inline: true
                        },
                        {
                            name: "ðŸ’¼ Total Acumulado de Vendas",
                            value: `R$ ${accumulatedSales.toFixed(2)}`,
                            inline: true
                        },
                        {
                            name: "ðŸ’¸ Total Acumulado de Impostos",
                            value: `R$ ${accumulatedTaxes.toFixed(2)}`,
                            inline: true
                        }
                    ],
                    footer: {
                        text: "Registro gerado automaticamente",
                        icon_url: "https://cdn-icons-png.flaticon.com/128/17705/17705887.png" // Ãcone
                    },
                    timestamp: new Date().toISOString() // Adiciona um timestamp
                }]
            };
    
            fetch(webhookUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                if (response.ok) {
                    alert('Dados enviados com sucesso!');
                } else {
                    alert('Erro ao enviar os dados.');
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Ocorreu um erro ao enviar os dados.');
            });
        });
    </script>
</html>
